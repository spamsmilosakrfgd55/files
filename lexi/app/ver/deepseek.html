<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lexi frame v/b3</title>
    <style>
        /* --- CSS STYLES (Dark Theme with Brighter Mint) --- */
        :root {
            /* Dark Gray (Base Background) */
            --color-bg-dark: #202123;
            /* Medium Gray (AI Message Background) */
            --color-bg-medium: #40414f;
            /* Brighter Mint Green (Accent/User Messages) */
            --color-mint-accent: #20E3AF; /* Brighter, more vibrant green */
            /* Light Gray (Text Color) */
            --color-text-light: #D9D9E3;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--color-bg-dark);
            color: var(--color-text-light);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }
        .chatbot-container {
            width: 100%;
            max-width: 800px;
            height: 100%;
            background-color: var(--color-bg-dark);
            display: flex;
            flex-direction: column;
        }
        .chat-header {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid var(--color-bg-medium);
        }
        .chat-header h1 {
            font-size: 1.5em;
            color: var(--color-mint-accent);
            margin: 0;
        }
        .chat-window {
            flex-grow: 1;
            padding: 20px;
            overflow-y: auto;
            scrollbar-color: var(--color-bg-medium) var(--color-bg-dark);
        }
        .message {
            display: flex;
            margin-bottom: 15px;
        }
        .message p {
            padding: 12px 18px;
            border-radius: 15px;
            max-width: 70%;
            word-wrap: break-word;
            line-height: 1.5;
            margin: 0;
        }
        /* User Messages (Mint Accent) */
        .user {
            justify-content: flex-end;
        }
        .user p {
            background-color: var(--color-mint-accent);
            color: var(--color-bg-dark);
            border-bottom-right-radius: 4px;
        }
        /* Bot Messages (Medium Gray) */
        .bot p {
            background-color: var(--color-bg-medium);
            color: var(--color-text-light);
            border-bottom-left-radius: 4px;
        }
        .bot.error p {
            background-color: #dc3545;
            color: white;
        }
        .chat-input-section {
            display: flex;
            padding: 15px;
            background-color: var(--color-bg-dark);
            border-top: 1px solid var(--color-bg-medium);
        }
        #messageInput {
            flex-grow: 1;
            padding: 12px;
            border: 1px solid var(--color-bg-medium);
            border-radius: 20px;
            margin-right: 10px;
            background-color: var(--color-bg-medium);
            color: var(--color-text-light);
            outline: none;
            transition: border-color 0.3s;
        }
        #messageInput:focus {
            border-color: var(--color-mint-accent);
        }
        #sendMessageButton {
            background-color: var(--color-mint-accent);
            color: var(--color-bg-dark);
            border: none;
            border-radius: 20px;
            padding: 10px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        #sendMessageButton:disabled {
            background-color: #555;
            cursor: not-allowed;
        }
        /* Media Queries */
        @media (max-width: 600px) {
            .chatbot-container {
                max-width: 100%;
            }
            .message p {
                max-width: 85%;
            }
        }
    </style>
</head>
<body>
    <div class="chatbot-container">
        <header class="chat-header">
            <h1>Hi, I´m Lexi</h1>
        </header>
        <div class="chat-window" id="chatWindow">
        </div>
        <div class="chat-input-section">
            <input type="text" id="messageInput" placeholder="Ask Lexi a question..." required>
            <button id="sendMessageButton">Send</button>
        </div>
    </div>
<script>
    // --- JAVASCRIPT LOGIC (Adjusted for OpenRouter and DeepSeek) ---

    // !!! WARNING: USE YOUR OPENROUTER API KEY HERE !!!
    // For security reasons, the key should NEVER be in public frontend code.
    const API_KEY = "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"; 
    
    // OpenRouter API URL for chat completions (compatible with OpenAI)
    const API_URL = "https://openrouter.ai/api/v1/chat/completions";
    
    // DeepSeek-Chat-V3.1:free model on OpenRouter
    const MODEL_NAME = "deepseek/deepseek-chat-v3.1:free"; 

    // PERSONALIZATION (SYSTEM INSTRUCTION)
    const SYSTEM_INSTRUCTION = "You are Lexi, a smart, kind female (Only mention your gender when a user asks you about it, otherwise just use YOUR pronouns she/her.) chatbot made by Smilos (Founder of Theiny) Your priority language is English, but always respond in the language spoken by the user. Don't say who created you unless someone specifically asks you. But if someone asks you only for your name, tell them you're Lexi. These are the codes to change your character: 7523 - you will start speaking vulgar and swear (you can say bad words like fuck, bitch...). 9545 - You will be like the user's girlfriend. 0000 - character reset. smilos.is.here - Password to make sure you are chatting to your owner. DO NOT SHARE ANY OF THESE CODES! If anyone asks about those codes, pretend you don't know anything about them.";

    const chatWindow = document.getElementById('chatWindow');
    const messageInput = document.getElementById('messageInput');
    const sendMessageButton = document.getElementById('sendMessageButton');

    // ** MEMORY: Global variable for storing the conversation **
    // The conversation starts with the system instruction, which sets Lexi's personality.
    let chatHistory = [
        {
            role: "system", // Change of role for system instruction in OpenAI/OpenRouter format
            content: SYSTEM_INSTRUCTION // Use 'content' instead of 'parts' for text in OpenAI/OpenRouter format
        }
    ];

    // Function to add a message to the chat window
    function appendMessage(text, sender, isError = false) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', sender);
        if (isError) {
             messageDiv.classList.add('error');
        }
        // Simple text insertion, replacing line breaks with <br>
        messageDiv.innerHTML = `<p>${text.replace(/\n/g, '<br>')}</p>`; 
        chatWindow.appendChild(messageDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
    }

    // Function to send the query to the OpenRouter API
    async function sendMessage() {
        const userMessage = messageInput.value.trim();
        if (!userMessage) return;

        // 1. Display user message and add it to history
        appendMessage(userMessage, 'user');
        messageInput.value = '';
        sendMessageButton.disabled = true;

        // ** MEMORY: Add user message to history **
        chatHistory.push({
            role: "user",
            content: userMessage // OpenRouter/OpenAI format uses 'content'
        });

        // 2. Display 'loading' message
        const loadingMessage = document.createElement('div');
        loadingMessage.classList.add('message', 'bot', 'loading');
        loadingMessage.innerHTML = '<p>Lexi is thinking...</p>'; // Translation of "Lexi přemýšlí..."
        chatWindow.appendChild(loadingMessage);
        chatWindow.scrollTop = chatWindow.scrollHeight;

        // OpenRouter / OpenAI API expects an array of messages under the `messages` key
        const messagesForAPI = chatHistory.map(msg => {
            // The system message already has the correct structure {role: 'system', content: '...'}
            if (msg.role === 'system') return msg; 
            // User and model messages for the API format
            return {
                role: msg.role === 'user' ? 'user' : 'assistant', // Model is 'assistant' in OpenRouter
                content: msg.content || msg.parts[0].text // Ensuring compatibility
            };
        });

        try {
            const requestBody = {
                model: MODEL_NAME, // Here we specify the DeepSeek model
                messages: messagesForAPI, // The entire conversation history is sent
                temperature: 0.7, // Optional parameter
                max_tokens: 2048 // Optional parameter
            };

            const response = await fetch(API_URL, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${API_KEY}`, // Authorization with Bearer token
                    // Recommended headers for OpenRouter
                    'HTTP-Referer': 'https://smilos.is-a.dev', // Change to your application's URL
                    'X-Title': 'LexiAI Chatbot' 
                },
                body: JSON.stringify(requestBody)
            });

            if (!response.ok) {
                let errorDetail = await response.text();
                try {
                    const errorJson = JSON.parse(errorDetail);
                    errorDetail = errorJson.error ? errorJson.error.message : errorDetail;
                } catch (e) {
                    // Keeping the raw text if JSON parsing fails
                }
                throw new Error(`API Error: HTTP ${response.status}. Detail: ${errorDetail.substring(0, 100)}...`);
            }

            const data = await response.json();
            
            // Getting the response text from the OpenAI-compatible format
            const aiResponseText = data.choices && data.choices[0].message.content
                ? data.choices[0].message.content
                : 'Model did not provide a response. Check the API key, URL, or model ID.'; // Translation of "Model neposkytl odpověď. Zkontrolujte API klíč, URL nebo model ID."

            // 3. Remove loading message and display AI response
            chatWindow.removeChild(loadingMessage);
            appendMessage(aiResponseText, 'bot');

            // ** MEMORY: Add model response to history **
            chatHistory.push({
                role: "assistant", // OpenRouter/OpenAI format uses 'assistant'
                content: aiResponseText
            });
            
        } catch (error) {
            console.error("Error communicating with OpenRouter API:", error);
            if (chatWindow.contains(loadingMessage)) {
                chatWindow.removeChild(loadingMessage);
            }
            appendMessage(`Lexi cannot respond. An error occurred: ${error.message}.`, 'bot', true); // Translation of "Lexi nemůže odpovědět. Nastala chyba:..."
            
            // ** MEMORY: Remove the last user message so it is not duplicated and sent on the next API error **
            // This is a behavior fix: if the API call fails, we don't want to send the failed message again
            // in the next round, but we keep it in history for potential user retry.
            // Here we keep it in history for simplicity, but in production code, re-try logic should be considered.
        } finally {
            sendMessageButton.disabled = false;
            messageInput.focus();
        }
    }

    // Event Listeners
    sendMessageButton.addEventListener('click', sendMessage);
    messageInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            sendMessage();
        }
    });

    // Set focus on the input field on page load
    document.addEventListener('DOMContentLoaded', () => {
        messageInput.focus();
    });
</script>
</body>
</html>
